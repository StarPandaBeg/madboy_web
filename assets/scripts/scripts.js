var hiddenState=window.localStorage.getItem("hidden");function prepareContext(e,t){$(".context").css("left",t.pageX),$(".context").css("top",t.pageY),$(".context ul li a").attr("href",e.data("path")),$(".context ul li a").data("name",e.data("name")),e.hasClass("file")?$(".context ul li:has(a#download,a#remoteopen)").show():$(".context ul li:has(a#download,a#remoteopen)").hide(),e.hasClass("file")?$(".context ul li:has(a#archive)").hide():$(".context ul li:has(a#archive)").show()}function send(e,t){$.ajax({url:e,data:t,processData:!1,cache:!1,contentType:!1,type:"POST",success:function(e){window.location.reload()}})}function setHiddenState(e){e?($(".filecard.hidden").show(),$("#hiddeneye").removeClass("fa-eye"),$("#hiddeneye").addClass("fa-eye-slash")):($(".filecard.hidden").hide(),$("#hiddeneye").removeClass("fa-eye-slash"),$("#hiddeneye").addClass("fa-eye"))}hiddenState=null===hiddenState||"true"===hiddenState,$(".context").hide(),setHiddenState(hiddenState),$(function(){$("body").on("contextmenu",function(e){e.preventDefault(),$(".context#cardcontext").hide(),prepareContext($(this),e),$(".context#maincontext").show()}),$("body").on("click",function(){$(".context").hide()}),$("body").on("keydown",function(e){"Escape"==e.key&&$(".context").hide()}),$(".file, .directory").on("contextmenu",function(e){e.stopPropagation(),e.preventDefault(),$(".context#maincontext").hide(),prepareContext($(this),e),$(".context#cardcontext").show()}),$("#archive").click(function(e){e.preventDefault();var t=new FormData;t.append("action","archive"),send($(this).attr("href"),t)}),$("#remoteopen").click(function(e){e.preventDefault();var t=new FormData;t.append("action","start"),send($(this).attr("href"),t)}),$("#rename").click(function(e){if(e.preventDefault(),newname=prompt("Введите новое имя файла",$(this).data("name")),null!=newname){var t=new FormData;t.append("action","rename"),t.append("name",newname),send($(this).attr("href"),t)}}),$("#delete").click(function(e){if(e.preventDefault(),confirm("Вы уверены, что хотите удалить "+$(this).data("name")+"?")){var t=new FormData;t.append("action","delete"),send($(this).attr("href"),t)}}),$("#newfolder").click(function(e){if(e.preventDefault(),newname=prompt("Введите имя новой папки",""),null!=newname){var t=new FormData;t.append("action","newfolder"),t.append("name",newname),send($(this).attr("href"),t)}}),$("#upload").click(function(){event.preventDefault();var e=document.createElement("input");e.type="file",e.onchange=(e=>{var t=e.target.files[0],n=new FormData;n.append("action","upload"),n.append("name",t.name),n.append("upload",t),send($(this).attr("href"),n)}),e.click()}),$("#hidden").click(function(){setHiddenState(hiddenState=!hiddenState),localStorage.setItem("hidden",hiddenState)})});